<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>ğŸ¥•ë‹¹ê·¼ë‚˜ë¼ ë²ˆê°œê³µì£¼</title>
<style>
#navbarDropdown{
	cursor:pointer;
}
/* Chrome, Safari, Edge, Opera */
input#bid::-webkit-outer-spin-button, input#bid::-webkit-inner-spin-button
	{
	-webkit-appearance: none;
	margin: 0;
}

/* Firefox  */
input#bid[type='number'] {
	-moz-appearance: textfield;
}
.box {
	width: 100%;
	border: 4px #eee solid;
	border-radius: 20px;
	margin: 10px;
	padding: 5px;
	transition: 0.2s;
}
.box:hover {
	transform: scale(1.05);
	transition: 0.3s;
}
</style>
</head>
<body th:align="center">
	<div class="d-flex" id="wrapper">
		<div id="page-content-wrapper">
			<th:block th:replace="~{fragment/header :: header}"></th:block>
			<!-- Page content-->
			<div class="container-fluid">
				<!------------ ì—¬ê¸°ë¶€í„° ë©”ì¸ ë°”ë””! ì—¬ê¸°ë¶€í„° ì‘ì„±í•˜ë©´ ë¨ ---------------->
				<section class="py-5" style="width: 1200px;">
		            <div class="container px-4 px-lg-5 my-5">
		                <div class="row gx-4 gx-lg-5 align-items-center">
		                <div class="small mb-1" th:switch="${product.pCategory.toString()}">
		                <span th:text="${product.auction.toString() == 'N'} ? '&nbsp;ì¼ë°˜ ' : '&nbsp;ê²½ë§¤ '" style="font-weight: bold; border-left: 4px solid #eee"></span>
						    <span th:case="DIGI">ë””ì§€í„¸/ê°€ì „</span>
						    <span th:case="FURN">ê°€êµ¬</span>
						    <span th:case="CLOT">ì˜ë¥˜/ì¡í™”</span>
						    <span th:case="BEAU">ë·°í‹°</span>
						    <span th:case="ETC">ê¸°íƒ€</span>
						</div>
		                    <div class="col-md-6" th:align="center"><img class="card-img-top mb-5 mb-md-0" style="max-height: 400px; max-width: 400px; object-fit:contain;"th:src="${product.upload}" onerror="this.src='/images/carrot.png'" alt="..."></div>
		                    
		                    <div class="col-md-6">
		                        <div class="" th:if="${product.auction.toString() == 'Y'}"><span id="clock" style="color: red; font-weight: bold;"></span></div>
		                        <h2 class="display-8 fw-bolder" style="margin-bottom: 0.8em"th:text="${product.title}"></h2>
		                        
		                        <div style="display: flex; margin-bottom: 20px;">
			                        <table th:cellpadding="0" style="flex-grow: 1;">
				                        <tr>
				                        	<td rowspan="2" style="width: 60px;"><img src="/images/prcs-profile.png" alt="..." style="width: 50px;"></td>
				                        	<td style="vertical-align: bottom">
					                        	<a  id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true"
															aria-expanded="false" style="font-size: 18px; margin-top: 10px;">
															<span th:text="${product.salesId.nickName}"></span></a>
					                        		
						                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
														<div class="dropdown-item">
														<a class="dropdown-item" th:href="@{/mypage/myPageMain(id=${product.salesId.id})}">í˜ì´ì§€ ë°©ë¬¸</a>
														</div>
													</div>
					                    
					                    
				                        	</td>
				                        </tr>
				                        <tr>
				                        	<td>&nbsp;<label style="font-size: 15px; margin-bottom: 10px; color: #aaa;" class="small" th:text="${product.salesId.location}"></label></td>
				                        </tr>
			                         </table>
			                         <div style="flex-grow: 1; height: 80px;">
			                       		<div th:if="${product.auction.toString() == 'Y'}" th:align="right">
				                            <div class="small" style="color: #aaa;"> ì‹œì‘ê°€ <span style="color: #aaa; text-decoration: line-through;" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA') + 'ì› '}"></span></div>
				                           í˜„ì¬ê°€ <span id="price" style="font-weight: bold;" th:align="center" th:text="${#numbers.formatInteger(auction.auctionPrice, 3, 'COMMA') + 'ì›'}"></span>
				                        </div>
				                        <div th:align="right" style="margin-bottom: 5px;"th:if="${product.auction.toString() == 'N'}">
				                            <span id="price" style="font-weight: bold;" th:align="right" th:text="${#numbers.formatInteger(product.price, 3, 'COMMA') + 'ì›'}"></span>
				                        </div>
				                        <div th:if="${product.sold.toString() == 'N'}">
					                        <div th:if="${product.salesId.id != currentUser.id}" th:align="right">
					                        	<button th:align="center" class="btn btn-outline-dark flex-shrink-0" type="button" onclick="like();" style="height: 35px;">
					                                <img id="like" alt="..." src="/images/empty_heart.png" style="width: 15px;">
					                            </button>
						                            <a class="btn btn-outline-dark flex-shrink-0" id="navbarDropdown" href="#"
															role="button" data-bs-toggle="dropdown" aria-haspopup="true"
															aria-expanded="false"  th:if="${product.auction.toString() == 'Y'}" type="button">
						                                <span style="font-size: 15px; padding: 0px;">ğŸ’°</span>
						                                
						                            </a>
						                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
														<div class="dropdown-item">
														<form id="bidForm" th:action="@{/product/bidProduct}" method="post">
						                       				<input th:value="${product.pNo}" name="pNo" type="hidden">
						                       				<input th:value="${currentUser.id}" name="id" type="hidden">
						                       				<input id="bid" name="bid" style="width: 100px; vertical-align: middle;" type="number" min="${auction.auctionPrice}">&nbsp;<a class="btn btn-outline-dark flex-shrink-0" type="button" onclick="bid();">ì…ì°°í•˜ê¸°</a>
						                       				<br><small>ì…ì°°ì€ ìµœëŒ€ 3ë²ˆê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</small>
						                       			</form>
														</div>
													</div>
													
						                            <button class="btn btn-outline-dark flex-shrink-0" th:if="${product.auction.toString() == 'N'}" type="button" onclick="buyBtn()">
						                                <span style="font-size: 15px; padding: 0px;">ğŸ›’</span>
						                            </button>
						                            
					                            </div>
		                       				</div>
		                       			<form id="buyForm" th:action="@{/product/buyProduct}" method="post">
		                       				<input th:value="${product.pNo}" name="pNo" type="hidden">
		                       				<input th:value="${currentUser.id}" name="id" type="hidden">
		                       			</form>
			                        </div>
		                        </div>
		                        
		                        <pre style="margin-bottom: 50px; max-height: 500px; white-space: pre-line; font-family: var(--bs-body-font-family);" class="lead" th:text="${product.content}"></pre>
		                        <div id="thunderBtn" th:if="${product.delevery.toString() == 'Y'}" th:align="center" class="box" onclick="thunder()">
									<b>âš¡ ì²œë‘¥ë§¨ ì´ìš© ìƒí’ˆì…ë‹ˆë‹¤! âš¡</b> <input id="delevery"
										style="display: none;" type="checkbox" name="delevery"
										value="1"><br> <small>ë°°ë‹¬ë¹„ 1,500ì›ì´ ì¶”ê°€ì ìœ¼ë¡œ ì°¨ê°ë©ë‹ˆë‹¤.</small>
								</div>
		                    </div>
		                </div>
		            </div>
		        </section>
				<br>
				<hr>
				<br>
				<div th:align="center">
					<a th:attr="style=${currentUser.id == product.salesId.id}? 'display: inline' : 'display: none'" style="display: block;" type="submit" class="btn btn-outline-dark flex-shrink-0"
						onclick="delConfirm();">ì‚­ì œ</a>
					<a type="button" class="btn btn-outline-dark flex-shrink-0"
						onclick="history.back();">ì´ì „</a>
				</div>
				<div style="height: 30px;"></div>
				<!------------ ì—¬ê¸°ê¹Œì§€ ë©”ì¸ ë°”ë””! ì—¬ê¸°ê¹Œì§€ ì‘ì„±í•˜ë©´ ë¨ ---------------->
			</div>
		</div>
	</div>
</body>
<script th:inline="javascript">
/*=============================================
 * ê²Œì‹œë¬¼ ì‚­ì œ
 *=============================================*/
function delConfirm() {
	if (confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
		window.location.href = '/product/deleteProduct?pNo=[[${product.pNo}]]&isAuc=[[${product.auction}]]';
	} else {
		return false;
	}
}

/*=============================================
 * ê²½ë§¤ ì‹œê°„ ê°±ì‹ 
 *=============================================*/
let Target = document.getElementById("clock");

function clock() {
	if (/*[[${product.auction.toString() == 'Y'}]]*/) {
		let regdate = new Date(/*[[${#dates.format(product.regdate, 'yyyy-MM-dd HH:mm:ss')}]]*/).getTime();
		let aucDuration = /*[[${product.aucDuration}]]*/;
		let aucDuToTime = aucDuration * 1000 * 60 * 60 * 24;
		let currentTime = new Date().getTime();
	    
	    let time = parseInt(regdate) + parseInt(aucDuToTime) - parseInt(currentTime);
	
	    if (time < 0) {
	    	Target.innerText = `ê²½ë§¤ ì¢…ë£Œ`;
	    	return
	    }
	    
	    let days = Math.floor(time / (1000 * 60 * 60 * 24));
	    let hours = Math.floor((time % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
	    let minutes = Math.floor((time % (1000 * 60 * 60)) / (1000 * 60));
	    let seconds = Math.floor((time % (1000 * 60)) / 1000);
	
	    Target.innerText = `ë‚¨ì€ ì‹œê°„ ${days >= 1 ? days + 'ì¼' : ''} ${hours < 10 ? '0' + hours : hours}:${minutes < 10 ? '0' + minutes : minutes}:${seconds < 10 ? '0' + seconds : seconds}`;

	}
}
clock();
setInterval(clock, 1000); // 1ì´ˆë§ˆë‹¤ ì‹¤í–‰
/*=============================================
 * ì°œ ë²„íŠ¼
 *=============================================*/
function like() {
    let likeImage = $('#like');
    if (likeImage.attr('src').endsWith("empty_heart.png")) {
        likeImage.attr('src', "/images/full_heart.png");
        // ì¢‹ì•„ìš” ë°ì´í„° ì¶”ê°€
    } else {
        likeImage.attr('src', "/images/empty_heart.png");
        // ì¢‹ì•„ìš” ë°ì´í„° ì‚­ì œ
    }
}
/*=============================================
 * ì²œë‘¥ë§¨ ë°ì´í„° ê°–ê³ ì˜¤ê¸°
 *=============================================*/


/*=============================================
 * êµ¬ë§¤ ë²„íŠ¼
 *=============================================*/
function buyBtn() {
	if (confirm("êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
		if ($('#delevery').length) {
			if(/*[[${product.price + 1500 < currentUser.deposit}]]*/) {
				console.log('2');
				$('#thunder').val(1);
				$('#buyForm').submit();
			} else {
				console.log('3');
				alert('ì¬ë”í˜ì´ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
				return false;
			}
		} else {
			console.log('4');
			$('#thunder').val(0);
			$('#buyForm').submit();
		}
	} else {
		return false;
	}
}

/*=============================================
 * ì…ì°°í•˜ê¸°
 *=============================================*/
 function bid() {
	if($('#bid').val() <= /*[[${auction.auctionPrice}]]*/) {
		alert("ì…ì°°ê°€ëŠ” í˜„ì¬ ê²½ë§¤ê°€ë³´ë‹¤ ë†’ì€ ê°€ê²©ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤!");
	} else if (/*[[${auctionCnt > 3}]]*/){
		alert("ë”ì´ìƒ ì…ì°°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
	} else {
		if(confirm('ì •ë§ ì…ì°°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
			if ($('#delevery').length) {
				if($('#bid').val() + 1500 <= /*[[${currentUser.deposit}]]*/) {
					$('#bidForm').submit();
				} else {
					alert('ì¬ë”í˜ì´ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
					return false;
				}
			} else {
				if($('#bid').val() <= /*[[${currentUser.deposit}]]*/) {
					$('#bidForm').submit();
				} else {
					alert('ì¬ë”í˜ì´ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!');
					return false;
				}
			}
		}
	}
}
</script>
</html>
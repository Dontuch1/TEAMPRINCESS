<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
<title>ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link th:href="@{/css/main.css}" rel="stylesheet">
<link th:href="@{/css/reply.css}" rel="stylesheet">
<link th:href="@{/css/myThunderList.css}" rel="stylesheet">

</head>
<body th:align="center">
	<div class="d-flex" id="wrapper">
		<div id="page-content-wrapper">
			<div th:insert="~{fragment/header :: header}"></div>
			<!-- Page content-->
			<div class="container-fluid">
				<!------------ ì—¬ê¸°ë¶€í„° ë©”ì¸ ë°”ë””! ì—¬ê¸°ë¶€í„° ì‘ì„±í•˜ë©´ ë¨ ------------- ---> 
			<th:block th:if="${board.userId.id}==${currentUser.id}">
				<button th:align="center" class="btn btn-outline-danger btn-lg blockbox" type="button" disabled>
                     â¤ <span  th:text="${board.great}">
                </span></button>
			</th:block>		
			<th:block th:if="${isGreated == false} and ${board.userId.id}!=${currentUser.id}">
				<button th:align="center" class="btn btn-outline-danger btn-lg blockbox" type="button" onclick="Great()">
                     â¤ <span  th:text="${board.great}">
                </span></button>
			</th:block>	
			<th:block th:if="${isGreated != false} and ${board.userId.id}!=${currentUser.id}">
            	<button th:align="center" class="btn btn-danger btn-lg blockbox" type="button" onclick="Great()">
                     â¤ <span style="color: #FFFFFF; font-weight: 700;" th:text="${board.great}">
                </span></button>
            </th:block>
			<div>
					<div> 
						<div th:align="center">
							<form th:action="@{/board/insertBoard}" method="get"></form>	
								<br>
								<h2 th:align="center" style="font-weight:700" th:text="${board.title}"></h2>
								<!-- NOTICE, LOST, FOOD, TMI, QNA, MEET ifë¬¸ ì‚¬ìš©í•´ì„œ í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ê°€ ë‚˜ì˜¤ë©´ ê¸€ì ë„ìš°ê¸° -->
								<br>
								<br>
							<div style="display:flex; width:1100" class="mb-3" th:switch="${board.cmCategory.toString()}">
								<span th:case="NOTICE" class="border-bottom left" style="flex-grow: 1;">ğŸš¨ ê³µì§€ì‚¬í•­</span>
								<span th:case="LOST" class="border-bottom left" style="flex-grow: 1;">ğŸ˜¥ ìƒì–´ë²„ë ¸ì–´ìš”</span>
								<span th:case="FOOD" class="border-bottom left" style="flex-grow: 1;">ğŸ” ì—¬ê¸° ë§›ë‚˜ìš”</span>
								<span th:case="TMI" class="border-bottom left" style="flex-grow: 1;">ğŸ”‰ ì•Œë ¤ë“œë ¤ìš”</span>
								<span th:case="QNA" class="border-bottom left" style="flex-grow: 1;">â“ &nbsp;ê¶ê¸ˆí•´ìš”</span>
								<span th:case="MEET" class="border-bottom left" style="flex-grow: 1;">ğŸ™‹â€â™€ï¸ ìš°ë¦¬ë§Œë‚˜ìš”</span>
							
						

								<span th:align="center" class="border-bottom " style="flex-grow: 1;"><span style="margin-left:800px" th:text="${board.regdate}"></span></span>	
							</div>	
							<div style="display:flex; width:1100" class="mb-3">
								<span th:align="left" style="font-weight:860; font-size:1.2rem; margin-left:30px; width: 500px;">
								<a style="text-decoration: none; color: #333;" th:href="@{/mypage/myPageMain(id=${board.userId.id})}"  th:text="${board.userId.nickName}"></a></span>
							
							<th:block th:if="${board.userId.nickName} != ${currentUser.nickName}">
							<span  th:align="center"  class="reportSpan">
								<button class="btn-report reportBtn" onclick="report()"><span>ğŸš¨ì‹ ê³ </span></button></span>
							</th:block>
							
							<th:block th:if="${board.userId.nickName} == ${currentUser.nickName}">
							<span  th:align="center"  class="reportSpan">
								<button class="btn-report reportBtn"><span>ğŸš¨</span></button></span>
							</th:block>
							</div>
							<div th:align="center">
									<th:block th:if="${board.photoPath} == null">
										<img src="/images/bigcarrot.png" alt="ì‚¬ì§„ ì¶œë ¥ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤."  style="width:250px; margin:50px;">
									</th:block>
									<th:block th:if="${board.photoPath} != null">
										<img th:src="@{${board.photoPath}}" alt="ì‚¬ì§„ ì¶œë ¥ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤."  style="width:600px;">
									</th:block>
								</div>
							<br><br>
							<div style="width:860px" align="left" th:align="center">
								<p style="font-size:1.3rem" th:text="${board.content}">
							</div>
							
							<!-- ì‹ ê³  form -->
							<form id="reportBoardForm" th:action="@{/board/reportBoard}" method="get">
                   				<input type="hidden" name="id" th:value="${currentUser.id}">
                   				<input type="hidden" name="type" value="COMMUNITY">
                   				<input type="hidden" name="postNum" th:value="${board.postNum}">
                   				<input id="reportBoardInput" type="hidden" name="rptCon">
                   			</form>
						</div>	
						<br>

				  	<!-- ëŒ“ê¸€ ì‘ì„± í¼ -->	
						<div th:align="center">
						 	<ul class="comment1">
								<li class="comment1-form">
									<form id="replyForm">
										<h4>ëŒ“ê¸€<span class="spansmall">( <span th:text="${currentUser.nickName}" class="spansmall"></span>ë‹˜ )</span></h4>
											<input type="hidden" id="boardId" th:value="${board.postNum}" />
									 		<input type="hidden" id="memberId" th:value="${#authentication.principal.username}" />
												<span class="ps_box1">
												<input type="text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." class="int1" name="content1" id="replyContent" />
												</span>
											<input type="submit" class="btn1" value="ë“±ë¡" />
									</form>
								</li>
								<li id="comment1-list"></li>
							</ul>
						 </div>
			
				<div th:align="center">
							<table id="replyList" style="width:800px">
								<tr th:each="reply, state : ${replies1}" class="border1">
							    	
							    	<td style="width: 120px;" th:align="center"   th:text="${reply.userId.nickName}"></td>
							    	<td style="width: 485px; padding:10px" th:text="${reply.replyContent}"></td>
							    	<td style="width: 130px" th:text="${reply.regdate}"></td>
						    	<th:block th:if="${#authentication.principal.username} == ${reply.userId.id}">
						    		<td><button style="width: 80px" class="btn btn-outline-secondary deleteReply" id="replyId" th:value="${reply.replyNum}" onclick="deleteReply(this)">ì‚­ì œ</button></td>
						    	</th:block>
							    <th:block th:if="${#authentication.principal.username} != ${reply.userId.id}">
						    		<td><button style="width: 80px" class="btn btn-outline-secondary deleteReply">ì‹ ê³ </button></td>
						    	</th:block>
							    </tr>
							</table>
						
							<th:block th:if="${endPage == 0}">
								 [ <strong style="color: red;">1</strong> ]
							</th:block> 
							<th:block th:if="${endPage != 0}" >
								<span class="center" style="flex-grow:12; font-size:1.1rem;">
							[ <th:block th:each="page : ${#numbers.sequence(startPage, endPage)}" >
								<a th:if="${page != nowPage}" style="text-decoration: none; color: #222;"
									th:href="@{/board/getBoard(postNum=${board.postNum}, id=${#authentication.principal.username}, page=${page - 1})}"
									th:text="${page}"> </a>
									<strong th:if="${page == nowPage}" th:text="${page}"
									style="color: red"></strong> 
								</th:block> ]
							</span>
							</th:block> 
						</div>

			<div th:align="center" class="deleteBoard">		
			<a th:href="@{/board/insertBoard}"><button type="button" class="btn btn-outline-secondary" style="margin:20px 5px 10px 5px">ìƒˆ ê²Œì‹œê¸€</button></a>
			<button type="button" class="btn btn-outline-secondary" style="margin:20px 5px 10px 5px" onclick="history.back()">ê¸€ ëª©ë¡</button>
			<th:block th:if="${#authentication.principal.username} == ${board.userId.id} and ${currentUser.auth.toString()} != 'ADMIN'">
            <a th:href="@{/board/deleteBoard(postNum=${board.postNum}, cmCategory=${board.cmCategory})}" style="margin:20px 5px 10px 5px" class="btn btn-outline-secondary deleteBoard">ê¸€ì‚­ì œ</a>
	         </th:block>
	         <th:block th:if="${currentUser.auth.toString()} == 'ADMIN' and ${#authentication.principal.username} == ${board.userId.id}">
	            <a th:href="@{/board/deleteBoard(postNum=${board.postNum}, cmCategory=${board.cmCategory})}" style="margin:20px 5px 10px 5px;" class=" btn btn-outline-secondary deleteBoard">ê¸€ì‚­ì œ</a>
	         </th:block>
			
			</div>		
	</div>	
	<th:block th:replace="~{fragment/footer :: footer}"></th:block>
</div>

	<!------------ ì—¬ê¸°ê¹Œì§€ ë©”ì¸ ë°”ë””! ì—¬ê¸°ê¹Œì§€ ì‘ì„±í•˜ë©´ ë¨ ---------------->
			</div>
		</div>
	</div>
</body>
<script th:inline="javascript">

function replyclick() {
    document.getElementById('replydisplay').style.display = "block";
}

//=======================================
//==  ëŒ“ê¸€ ì‘ì„±
//=======================================
let boardId = $('#boardId').val();
let replycontent = $('#reReplyContent').text();
console.log(replycontent);
console.log(boardId);

	 $('#replyForm').submit(function(e) {
        e.preventDefault();

        let replyData = {
            "replyContent": $('#replyContent').val(),
            "memberId":  $('#memberId').val(),
            "boardId": boardId
        }
		
        if($('#replyContent').val() != ""){
        	$.ajax({
                type: "POST",
                url: "/reply/insertReply",
                data: JSON.stringify(replyData),
                contentType: "application/json",
                success: function(response) {
                	document.location.reload();
                },

                error: function(error) {
                    alert("ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
                    return;
                }
            });
        } else {
        	alert("ëŒ“ê¸€ì— ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        	return;
        }
  	});
	

//=======================================
//==  ì‹ ê³  ë²„íŠ¼
//=======================================
function report() {
	 if([[${isReportedboard}]]) {
		 alert('ì´ë¯¸ ì‹ ê³ í•˜ì…¨ë„¤ìš”!');
		 return;
	 } else {
		 if (confirm("ì–´ë–¤ ë‚˜ìœ ì¼ì´ ì¼ì–´ë‚˜ê³  ìˆë‚˜ìš”?")) {
			    let promptResult = prompt("ê´€ë¦¬ìì—ê²Œ ì‚¬ìœ ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”!");
			    if (promptResult == null) {
			    	return;
			    } else if (promptResult == "") {
			    	alert("ì‹ ê³  ì‚¬ìœ ë¥¼ ì ì–´ì£¼ì…”ì•¼ í•´ìš”!");
			    	return;
			    } else {
			    	$('#reportBoardInput').val(promptResult);
			      	$('#reportBoardForm').submit();
			    }
			}
	 }
}

//=======================================
//==  ëŒ“ê¸€ ì‚­ì œ
//=======================================

function deleteReply(ele) {	
	console.log(ele);
	console.log("value="+ele.value);
	let no=ele.value;
	console.log(no);
	
	 let replyData = {
		"replyNum" : no 
	 }
	
	$.ajax({
        type: "POST",
        url: "/reply/delete",
        data: JSON.stringify(replyData),
        contentType: "application/json",
        success: function(response) {
        	document.location.reload();
        	return;
        },
        error: function(error) {
            alert("ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
            return;
        }
    });
}

/*=============================================
 * ì¢‹ì•„ìš” ë²„íŠ¼
 *=============================================*/
 function Great() {
	 location.href="/board/updateGreat?postNum=[[${board.postNum}]]";
}
</script>
</html>

